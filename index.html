<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Writing & Sharing Great Modules</title>

    <meta name="description" content="Writing and Sharing Great Modules on the Forge">
    <meta name="author" content="@nullfinch, Puppet Labs">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section>
          <h1>Writing & Sharing Great Modules</h1>
          <h3></h3>
          <p>
          <small>@nullfinch, Puppet Labs</small>
          </p>
        </section>

        
          <section id="slide-2">
            <!-- === begin markdown block =====================================================

      generated by markdown 1.0.0 on Ruby 1.9.3 (2013-02-22) [x86_64-linux]
                on 2013-04-29 06:48:51 -0700 with Markdown engine kramdown (1.0.1)
                  using options { !to be done! }
  -->

<!-- _S9SLIDE_ -->
<h2 id="who-is-this-guy">Who is this guy?</h2>

<ul>
  <li class="fragment">On/Off Ops/Dev, ~8 years</li>
  <li class="fragment">Operations Engineer @puppetlabs, 2 years</li>
  <li class="fragment">Community Developer @puppetlabs, 3 months</li>
</ul>



          </section>
        
          <section id="slide-3">
            <!-- _S9SLIDE_ -->
<h2 id="things-i-do">Things I do</h2>

<ul>
  <li class="fragment">puppet-network: cross-platform network configuration</li>
  <li class="fragment">puppet-portage: Puppet ♥ Gentoo</li>
  <li class="fragment">r10k: smarter Puppet deployment, powered by robots</li>
  <li class="fragment">vagrant-hosts: it’s always a DNS problem</li>
  <li class="fragment">vagrant-pe_build: From zero to PE in <code>vagrant up</code></li>
</ul>



          </section>
        
          <section id="slide-4">
            <!-- _S9SLIDE_ -->
<h2 id="other-things-i-do">Other things I do</h2>

<ul>
  <li class="fragment">Talk too fast</li>
  <li class="fragment">If I become completely unintelligible</li>
  <li class="fragment"><em>slow me down</em></li>
</ul>


          </section>
        
          <section id="slide-5">
            <!-- _S9SLIDE_  -->

<h1 id="lets-talk-about-modules">Let’s talk about modules</h1>



          </section>
        
          <section id="slide-6">
            <!-- _S9SLIDE_ -->
<h2 id="best-practices">BEST PRACTICES‽</h2>

<ul>
  <li class="fragment">Traditional development: 40+ years to mature</li>
  <li class="fragment">Modern config. mgmt: 15 years, max</li>
  <li class="fragment">Best practices haven’t yet been established</li>
</ul>



          </section>
        
          <section id="slide-7">
            <!-- _S9SLIDE_ -->
<h2 id="so-where-do-we-start">So where do we start?</h2>

<ul>
  <li class="fragment">Separate your logic and configuration</li>
  <li class="fragment">Know your interface</li>
  <li class="fragment">Use semantic versioning</li>
  <li class="fragment">Reuse everything</li>
  <li class="fragment">Use the community</li>
</ul>


          </section>
        
          <section id="slide-8">
            <!-- _S9SLIDE_  -->

<h1 id="datalogic-separation">Data/Logic separation</h1>



          </section>
        
          <section id="slide-9">
            <!-- _S9SLIDE_ -->
<h2 id="separate-logic-from-data">Separate logic from data</h2>

<p>Logic != Data</p>

<ul>
  <li class="fragment">Example: configure a service on different platforms</li>
  <li class="fragment">Shouldn’t have to update every file in a module</li>
</ul>



          </section>
        
          <section id="slide-10">
            <!-- _S9SLIDE_ -->
<h2 id="packagefileservice">Package/file/service</h2>

<p>Humble beginnings for many modules</p>

<pre><code>class mysql::server {
  package { 'mysql-server':
    ensure =&gt; present,
  }

  file { '/etc/mysql/my.cnf':
    ensure  =&gt; present,
    content =&gt; template('mysql/server/my.cnf.erb'),
    require =&gt; Package['mysql-server'],
  }

  service { 'mysqld':
    ensure    =&gt; running,
    enable    =&gt; true,
    subscribe =&gt; File['/etc/mysql/my.conf'],
  }
}
</code></pre>



          </section>
        
          <section id="slide-11">
            <!-- _S9SLIDE_ -->
<h2 id="problems-with-packagefileservice">Problems with package/file/service</h2>

<ul>
  <li class="fragment">Nothing inherently wrong</li>
  <li class="fragment">Overly simple</li>
  <li class="fragment"><em>Very</em> static</li>
  <li class="fragment">Generally requires overhaul for different platforms</li>
</ul>



          </section>
        
          <section id="slide-12">
            <!-- _S9SLIDE_ -->
<h2 id="rudimentary-datalogic-separation">Rudimentary Data/Logic separation</h2>

<pre><code>class mysql::server {
  include mysql::params

  package { 'mysql-server':
    name   =&gt; $mysql::params::server_package,
    ensure =&gt; present,
  }

  file { 'my.cnf':
    path    =&gt; $mysql::params::server_config,
    ensure  =&gt; present,
    source  =&gt; 'puppet:///modules/nrpe/nrpe.cfg',
    require =&gt; Package['nagios-nrpe-server'],
  }

  service { 'mysql-server':
    name      =&gt; $mysql::params::server_service,
    ensure    =&gt; running,
    enable    =&gt; true,
    subscribe =&gt; File['my.cnf'],
  }
}
</code></pre>



          </section>
        
          <section id="slide-13">
            <!-- _S9SLIDE_ -->
<h2 id="hardcoding-tunable-values">Hardcoding tunable values</h2>

<ul>
  <li class="fragment">Want to prevent people from reusing your modules?</li>
  <li class="fragment">Hardcode everything!</li>
</ul>



          </section>
        
          <section id="slide-14">
            <!-- _S9SLIDE_ -->
<h2 id="using-params-bad">Using params, bad:</h2>

<pre><code>class mysql::params {
  $allow_hosts   = '0.0.0.0/0'
  $root_user     = 'root'
  # ¯\_(ツ)_/¯
  $root_password = 'changeme'
}
</code></pre>

<ul>
  <li class="fragment">Params class = good</li>
  <li class="fragment">Why is this bad?
    <ul>
      <li class="fragment">Site specific defaults?</li>
      <li class="fragment">INSECURE DEFAULTS‽</li>
    </ul>
  </li>
</ul>



          </section>
        
          <section id="slide-15">
            <!-- _S9SLIDE_ -->
<h2 id="using-params-good">Using params, good:</h2>

<pre><code>class mysql::params(
  $allow_hosts,   # Force the module user to fill this out
  $root_password, # Fail fast rather than potentially use bad data
  $root_user = 'root' # Sane default
) {
}
</code></pre>

<ul>
  <li class="fragment">Force user to supply data</li>
  <li class="fragment">Fail fast</li>
</ul>


          </section>
        
          <section id="slide-16">
            <!-- _S9SLIDE_  -->

<h1 id="data-binding">Data Binding</h1>



          </section>
        
          <section id="slide-17">
            <!-- _S9SLIDE_ -->
<h2 id="data-binding-1">Data Binding</h2>

<ul>
  <li class="fragment">New in Puppet 3: data binding</li>
  <li class="fragment">Provides a method for configuring modules</li>
</ul>



          </section>
        
          <section id="slide-18">
            <!-- _S9SLIDE_ -->
<h2 id="using-data-binding">Using Data Binding</h2>

<ul>
  <li class="fragment">Define data in a data store
    <ul>
      <li class="fragment">file</li>
      <li class="fragment">database</li>
      <li class="fragment">Foreman</li>
    </ul>
  </li>
  <li class="fragment">Automatically load data in the relevant manifests</li>
</ul>



          </section>
        
          <section id="slide-19">
            <!-- _S9SLIDE_ -->
<h2 id="using-data-binding-1">Using Data Binding</h2>

<pre><code>class mysql::params(
  $allow_hosts,
  $database_password,
  $database_user = 'root'
) {
}
</code></pre>

<hr />

<pre><code># $datadir/common.yaml
---
mysql::params::allow_hosts: '10.126.8.0/24'
</code></pre>
<pre><code># $datadir/qa.mysite.local.yaml
---
mysql::params::allow_hosts: '10.134.8.0/24'
</code></pre>


          </section>
        
          <section id="slide-20">
            <!-- _S9SLIDE_  -->

<h1 id="using-modules-as-interfaces">Using modules as interfaces</h1>



          </section>
        
          <section id="slide-21">
            <!-- _S9SLIDE_ -->
<h2 id="modules-as-interfaces">Modules as interfaces</h2>

<ul>
  <li class="fragment">Puppet simplifies management of services</li>
  <li class="fragment">Defines how people interact with that service</li>
  <li class="fragment">Puppet modules define an interface for that service</li>
</ul>
<ul>
  <li class="fragment">Creates two challenges
    <ul>
      <li class="fragment">What options are supported?</li>
      <li class="fragment">What options should users configure?</li>
    </ul>
  </li>
</ul>



          </section>
        
          <section id="slide-22">
            <!-- _S9SLIDE_ -->
<h2 id="be-opinionated">Be opinionated</h2>

<ul>
  <li class="fragment">Cannot make every option tunable</li>
  <li class="fragment">You’ll go insane</li>
</ul>
<ul>
  <li class="fragment">Require mandatory data</li>
  <li class="fragment">Add parameters for frequently changed data</li>
  <li class="fragment">Offer an ‘override’ option</li>
</ul>



          </section>
        
          <section id="slide-23">
            <!-- _S9SLIDE_ -->
<h2 id="but-other-opinions-are-nice-too">But other opinions are nice too</h2>

<ul>
  <li class="fragment">You can’t always support every option</li>
  <li class="fragment">Allow people to directly insert their own configuration</li>
</ul>



          </section>
        
          <section id="slide-24">
            <!-- _S9SLIDE_ -->
<h2 id="override-example-partial-templates">Override example: Partial Templates</h2>

<ul>
  <li class="fragment">Module provides template fragments</li>
  <li class="fragment">User assembles these into a full config</li>
</ul>



          </section>
        
          <section id="slide-25">
            <!-- _S9SLIDE_ -->
<h2 id="creating-a-partial-template">Creating a partial template</h2>

<pre><code>&lt;%# nginx/templates/vhost/_listen.conf.erb %&gt;
&lt;%# Configuration fragment for listening on IPv4 and IPv6 with SSL %&gt;
&lt;% unless @sslonly -%&gt;
  listen   &lt;%= port %&gt;;
&lt;%   if scope.lookupvar('::ipaddress6') -%&gt;
  listen   [::]:&lt;%= port %&gt;;
&lt;%   end -%&gt;
&lt;% end -%&gt;

&lt;% if ssl -%&gt;
  listen   &lt;%= ssl_port %&gt; ssl;
&lt;%   if scope.lookupvar('::ipaddress6') -%&gt;
  listen   [::]:&lt;%= ssl_port %&gt; ssl;
&lt;%   end -%&gt;
&lt;% end -%&gt;
</code></pre>



          </section>
        
          <section id="slide-26">
            <!-- _S9SLIDE_ -->
<h2 id="using-partial-templates">Using partial templates</h2>

<p>Example: <code>my_nginx_app/templates/nginx-vhost.conf.erb</code></p>

<pre><code>server {
&lt;%= scope.function_template(['nginx/vhost/_listen.conf.erb']) %&gt;

  root /usr/share/empty;

  location / {
    proxy_pass &lt;%= @proto %&gt;://workers;
    proxy_redirect        off;
    proxy_next_upstream   error timeout invalid_header http_500 http_503;
    proxy_connect_timeout 5;
  }
}
</code></pre>


          </section>
        
          <section id="slide-27">
            <!-- _S9SLIDE_  -->

<h1 id="semver">SemVer</h1>



          </section>
        
          <section id="slide-28">
            <!-- _S9SLIDE_ -->
<h2 id="without-semantic-versioning">Without Semantic Versioning</h2>

<h3 id="changelog">CHANGELOG</h3>

<ul>
  <li class="fragment">1.0.0 Initial release for managing cacti</li>
  <li class="fragment">1.1.1 Change <code>server</code> param to <code>servername</code></li>
  <li class="fragment">1.1.2 Move params from cacti::data to cacti::params</li>
  <li class="fragment">1.2.0 Updated README</li>
  <li class="fragment">1.2.1 Drops support for CentOS 5</li>
  <li class="fragment">1.3.0 This module now manages munin</li>
  <li class="fragment">2.0.0 I can update versions whenever I want?</li>
  <li class="fragment">10.51.100 THIS IS AWESOME!</li>
  <li class="fragment">-4.number.999999999999 I’VE CREATED A MONSTER</li>
</ul>



          </section>
        
          <section id="slide-29">
            <!-- _S9SLIDE_ -->
<h2 id="upgrading-should-be-boring">Upgrading should be boring</h2>

<ul>
  <li class="fragment">API breaks mean upgrading is dangerous</li>
  <li class="fragment">Nobody wants to upgrade if it means explosions</li>
  <li class="fragment">Semantic versioning helps mitigate this</li>
</ul>



          </section>
        
          <section id="slide-30">
            <!-- _S9SLIDE_ -->
<h2 id="what-is-semver">What is SemVer?</h2>

<ul>
  <li class="fragment">Version strings should have meaning</li>
  <li class="fragment">Releases match the format x.y.z</li>
  <li class="fragment">Values indicate what’s changed in that version</li>
</ul>



          </section>
        
          <section id="slide-31">
            <!-- _S9SLIDE_ -->
<h2 id="major-releases">Major Releases</h2>

<p>Example: <strong>x</strong>.0.0</p>

<p>Backwards incompatible changes</p>

<ul>
  <li class="fragment">Changing class names</li>
  <li class="fragment">Changing parameter names</li>
  <li class="fragment">Dropping platform support</li>
</ul>



          </section>
        
          <section id="slide-32">
            <!-- _S9SLIDE_ -->
<h2 id="minor-releases">Minor Releases</h2>

<p>Example: x.<strong>y</strong>.0</p>

<p>Backwards compatible features</p>

<ul>
  <li class="fragment">Adding support for new platforms</li>
  <li class="fragment">Adding parameters</li>
  <li class="fragment">Adding features</li>
</ul>



          </section>
        
          <section id="slide-33">
            <!-- _S9SLIDE_ -->
<h2 id="patch-releases">Patch Releases</h2>

<p>Example: x.y.<strong>z</strong></p>

<ul>
  <li class="fragment">Bugfixes</li>
  <li class="fragment">Documentation</li>
  <li class="fragment">Tests</li>
  <li class="fragment">Anything that can’t be called a feature</li>
</ul>



          </section>
        
          <section id="slide-34">
            <!-- _S9SLIDE_ -->
<h2 id="semver-as-a-contract">SemVer as a contract</h2>

<ul>
  <li class="fragment">If you use SemVer, you’re making an agreement to avoid making breaking changes</li>
  <li class="fragment">What is a breaking change?</li>
  <li class="fragment">What’s public?</li>
  <li class="fragment">What’s private?</li>
</ul>



          </section>
        
          <section id="slide-35">
            <!-- _S9SLIDE_ -->
<h2 id="what-is-public">What is public?</h2>

<ul>
  <li class="fragment">Publicly exposed classes</li>
  <li class="fragment">Class parameters</li>
  <li class="fragment">The final behavior of your class</li>
</ul>



          </section>
        
          <section id="slide-36">
            <!-- _S9SLIDE_ -->
<h2 id="what-is-private">What is private?</h2>

<ul>
  <li class="fragment">The actual resources used in your classes and defines
    <ul>
      <li class="fragment">Resources themselves are implementation, not</li>
    </ul>
  </li>
  <li class="fragment">Classes that are documented as private
    <ul>
      <li class="fragment">If you document that a class is private, people shouldn’t use it</li>
    </ul>
  </li>
</ul>



          </section>
        
          <section id="slide-37">
            <!-- _S9SLIDE_ -->
<h2 id="safety-in-semver">Safety in SemVer</h2>

<ul>
  <li class="fragment">SemVer takes the risk out of upgrading</li>
  <li class="fragment">You can understand the implications of upgrading right away</li>
</ul>
<ul>
  <li class="fragment">How Puppet does it
    <ul>
      <li class="fragment">3.1.1: Security fixes</li>
      <li class="fragment">3.2.0: External CA support, types &amp; providers for OpenWRT</li>
      <li class="fragment">4.0.0: Tachyon based transport layer
        <ul>
          <li class="fragment">Not really.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


          </section>
        
          <section id="slide-38">
            <!-- _S9SLIDE_  -->

<h1 id="make-other-people-do-your-work">Make other people do your work</h1>


          </section>
        
          <section id="slide-39">
            <!-- _S9SLIDE_  -->

<h1 id="aka">AKA</h1>


          </section>
        
          <section id="slide-40">
            <!-- _S9SLIDE_  -->

<h1 id="reuse-modules">Reuse Modules</h1>



          </section>
        
          <section id="slide-41">
            <!-- _S9SLIDE_ -->
<h2 id="reuse-modules-1">Reuse Modules</h2>

<ul>
  <li class="fragment">Writing good code is hard.</li>
  <li class="fragment">Make other people do your work.</li>
</ul>



          </section>
        
          <section id="slide-42">
            <!-- _S9SLIDE_ -->
<h2 id="discovery-via-the-forge">Discovery via the Forge</h2>

<ul>
  <li class="fragment">Puppet Forge has 1000+ modules</li>
  <li class="fragment">Provides a single point to discover and install modules</li>
</ul>



          </section>
        
          <section id="slide-43">
            <!-- _S9SLIDE_ -->
<h2 id="get-dependencies-from-the-forge">Get Dependencies from the Forge</h2>

<pre><code>grey% puppet module search postgres
Notice: Searching https://forge.puppetlabs.com ...
NAME                   DESCRIPTION
knowshan-phppgadmin    Install and configure phpPgAdmin
DropPod-postgres       A basic type for managing Postgres
camptocamp-pgconf      Manage postgresql.conf entries
inkling-postgresql     PostgreSQL defined resource types
akumria-postgresql     Install and configure the Postgresql
puppetlabs-postgresql  PostgreSQL defined resource types
</code></pre>



          </section>
        
          <section id="slide-44">
            <!-- _S9SLIDE_ -->
<h2 id="collaborate-on-existing-modules">Collaborate on existing modules</h2>

<ul>
  <li class="fragment">Lots of good modules are out there</li>
  <li class="fragment">Encourage people to publish on the Forge</li>
  <li class="fragment">Help improve existing modules</li>
</ul>



          </section>
        
          <section id="slide-45">
            <!-- _S9SLIDE_ -->
<h2 id="small-contributions-help">Small contributions help</h2>

<ul>
  <li class="fragment">Documentation</li>
  <li class="fragment">Bug fixes</li>
  <li class="fragment">Issue reports</li>
</ul>


          </section>
        
          <section id="slide-46">
            <!-- _S9SLIDE_  -->

<h1 id="establish-a-community">Establish a Community</h1>



          </section>
        
          <section id="slide-47">
            <!-- _S9SLIDE_ -->
<h2 id="surviving-success">Surviving success</h2>

<ul>
  <li class="fragment">Your module is a hit!</li>
  <li class="fragment">Prepare for a deluge of bug reports and feature requests</li>
</ul>



          </section>
        
          <section id="slide-48">
            <!-- _S9SLIDE_ -->
<h2 id="popularity--more-work">Popularity = more work</h2>

<p>Things users are good at:</p>

<ul>
  <li class="fragment">Finding bugs</li>
  <li class="fragment">Filing feature requests</li>
  <li class="fragment">Requesting things like “documentation”</li>
  <li class="fragment">Finding more bugs</li>
</ul>
<ul>
  <li class="fragment">Funny how these match how you can help other contributors</li>
</ul>



          </section>
        
          <section id="slide-49">
            <!-- _S9SLIDE_ -->
<h2 id="harness-your-users">Harness your users</h2>

<ul>
  <li class="fragment">Bug reports = people care</li>
  <li class="fragment">Show people how to help</li>
  <li class="fragment">Ask for pull requests</li>
  <li class="fragment">Guide people through the contribution process</li>
</ul>


          </section>
        
          <section id="slide-50">
            <!-- _S9SLIDE_  -->

<h1 id="end">END</h1>

<h3 id="questions">Questions?</h3>

<h4 id="comments">Comments?</h4>

<h5 id="snarky-remarks">Snarky remarks?</h5>

<h5 id="smallawkward-silencesmall"><small>Awkward silence?</small></h5>



          </section>
        
          <section id="slide-51">
            <!-- _S9SLIDE_ -->
<h2 id="credits">Credits</h2>

<ul>
  <li class="fragment">Presentation done with reveal.js</li>
</ul>
<!-- === end markdown block ===================================================== -->

          </section>
        

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
